<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="theme-color" content="#000000">
    <!--
      manifest.json provides metadata used when your web app is added to the
      homescreen on Android. See https://developers.google.com/web/fundamentals/engage-and-retain/web-app-manifest/
    -->
    <link rel="manifest" href="%PUBLIC_URL%/manifest.json">
    <link rel="shortcut icon" href="%PUBLIC_URL%/favicon.ico">
    <!--
      Notice the use of %PUBLIC_URL% in the tags above.
      It will be replaced with the URL of the `public` folder during the build.
      Only files inside the `public` folder can be referenced from the HTML.

      Unlike "/favicon.ico" or "favicon.ico", "%PUBLIC_URL%/favicon.ico" will
      work correctly both with client-side routing and a non-root public URL.
      Learn how to configure a non-root public URL by running `npm run build`.
    -->
    <title>Accela Citizen Access</title>

    <script defer src="https://use.fontawesome.com/releases/v5.0.9/js/all.js" integrity="sha384-8iPTk2s/jMVj81dnzb/iFR2sdA7u06vHJyyLlAd4snFpCl/SnyUjRrbdJsw1pGIl" crossorigin="anonymous"></script>
    <script type="text/javascript" src="./setIntercom.js"></script>

  </head>
  <body>
    <noscript>
      You need to enable JavaScript to run this app.
    </noscript>
    <div id="root"></div>
    <!--
      This HTML file is a template.
      If you open it directly in the browser, you will see an empty page.

      You can add webfonts, meta tags, or analytics to this file.
      The build step will place the bundled scripts into the <body> tag.

      To begin the development, run `npm start` or `yarn start`.
      To create a production bundle, use `npm run build` or `yarn build`.
    -->

  <script>
    /* Secret keeping workaround for not being able to customize Webpack:
      (also make sure to whitelist domain in Settings > App Settings > General Settings)

      Make a file named .env with `export INTERCOM_ID="APP ID HERE"`.
      In the terminal, type `source .env`.
      Open a new terminal tab and run the app.

      Must also have file named setIntercom.js with contents:
      function setIntercom() {
        window.intercomSettings = {
          app_id: "APP ID HERE"
        };
      }
    */
    setIntercom()
  </script>

  <script>
    (function(){
      var w=window;var ic=w.Intercom;
      if(typeof ic==="function"){ic('reattach_activator');ic('update',intercomSettings);}
      else{var d=document;var i=function(){i.c(arguments)};
      i.q=[];i.c=function(args){i.q.push(args)};
      w.Intercom=i;
      function l(){
        var s=d.createElement('script');
        s.type='text/javascript';
        s.async=true;
        s.src=`https://widget.intercom.io/widget/${process.env.INTERCOM_ID}`;
        var x=d.getElementsByTagName('script')[0];
        x.parentNode.insertBefore(s,x);
      }
      if(w.attachEvent){w.attachEvent('onload',l);}
      else{w.addEventListener('load',l,false);}}
    })()
  </script>


<!-- BEGIN INTERCOM ACCESSIBILITY HACK -->
  <style type="text/css">
    #live-chat-accessibility-message {
      display: none;
      /* CHANGE THIS BACKGROUND COLOR TO BE SLIGHTLY LIGHTER THAN YOUR INTERCOM COLOR TO SHOW FOCUS */
      background-color: #f4903e;
      position: fixed;
      background-attachment: scroll;
      right: 6vw;
      bottom: 18vh;
      padding: 1em;
      color: white;
      font-size: 1em;
      font-weight: bolder;
      border-radius: 10px;
      font-family: sans-serif;
    }

    #live-chat-accessibility-message.visible {
      display: unset;
    }
  </style>

  <script type="text/javascript">
    // CUSTOMIZE THIS ALT TEXT TO PROVIDE YOUR PHONE NUMBER
    const altText = 'Live chat is not accessible without mouse. Please call PHONE NUMBER for assistance with Accela Citizen Access.'

    const addAria = setInterval(function() {
      const frameContainer = document.getElementById('intercom-container')
      if(frameContainer) {
        // Get the intercom element that can change color to show focus
        const intercomFrame = frameContainer.getElementsByTagName('iframe')[0].contentDocument
        const intercom = intercomFrame.getElementsByClassName('intercom-launcher')[0]

        const accessibilityMessageDiv = document.createElement('div')
        accessibilityMessageDiv.setAttribute('id', 'live-chat-accessibility-message')
        document.body.appendChild(accessibilityMessageDiv)

        intercom.tabIndex = 0
        intercom.setAttribute('role', 'img')
        intercom.setAttribute('alt', altText)
        intercom.setAttribute('title', altText)
        // This div should contain the same message for folks not using the mouse
        accessibilityMessageDiv.innerHTML = altText

        intercom.onfocus = function() {
          // CHANGE THIS COLOR TO MATCH THE BACKGROUND COLOR OF FOCUSED INTERCOM (SEE STYLE TAG)
          this.style['background-color'] = '#f4903e'
          // Visible div style is display: unset, as set above
          accessibilityMessageDiv.setAttribute('class', 'visible')
        }
        intercom.onblur = function() {
          this.style['background-color'] = 'unset'
          // Without the 'visible' class, the display is set to 'none'
          accessibilityMessageDiv.setAttribute('class', null)
        }
        clearInterval(addAria)
      }
    }, 100)

    function addLoadEvent(func) {
      const oldonload = window.onload;
      if (typeof window.onload != 'function') {
        window.onload = func;
      } else {
        window.onload = function() {
          if (oldonload) {
            oldonload();
          }
          func();
        }
      }
    }

    addLoadEvent(addAria);
  </script>
<!-- END INTERCOM ACCESIBILITY HACK -->

  </body>
</html>
